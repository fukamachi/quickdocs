
(:TYPE :SYSTEM :NAME "cl-web-crawler" :AUTHOR
 "Aaron Sokoloski <asokoloski@gmail.com>" :MAINTAINER NIL :VERSION "0.2"
 :LICENCE "MIT License" :DESCRIPTION
 "A generic web-crawling library for Common Lisp." :LONG-DESCRIPTION NIL
 :DEPENDS-ON ("DRAKMA" "PURI" "CL-PPCRE" "CL-HTML-PARSE") :PACKAGE-LIST
 ((:TYPE :PACKAGE :NAME "UNIQUE-QUEUE" :FULL-NAME "UNIQUE-QUEUE" :DOCUMENTATION
   NIL :SYMBOL-LIST
   ((:TYPE :CLASS :SYMBOL
     (:NAME "UNIQUE-QUEUE" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL)
     :SUPER-CLASS-LIST NIL :DOCUMENTATION NIL :SLOT-LIST
     ((:TYPE :CLASS-SLOT :SYMBOL
       (:NAME "QLIST" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL) :ACCESSORS
       ((:NAME "QLIST" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL)) :READERS
       NIL :WRITERS NIL :DOCUMENTATION NIL)
      (:TYPE :CLASS-SLOT :SYMBOL
       (:NAME "QTAIL" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL) :ACCESSORS
       ((:NAME "QTAIL" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL)) :READERS
       NIL :WRITERS NIL :DOCUMENTATION NIL)
      (:TYPE :CLASS-SLOT :SYMBOL
       (:NAME "KEY" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL) :ACCESSORS
       ((:NAME "KEY" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL)) :READERS NIL
       :WRITERS NIL :DOCUMENTATION NIL)
      (:TYPE :CLASS-SLOT :SYMBOL
       (:NAME "QHASH" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL) :ACCESSORS
       ((:NAME "QHASH" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL)) :READERS
       NIL :WRITERS NIL :DOCUMENTATION NIL)))
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "MAKE-UNIQUE-QUEUE" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T)
     :LAMBDA-LIST
     ((:NAME "&KEY" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T)
      ((:NAME "TEST" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL)
       ((:NAME "QUOTE" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T)
        (:NAME "EQL" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T)))
      ((:NAME "KEY" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL)
       ((:NAME "FUNCTION" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T)
        (:NAME "IDENTITY" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T))))
     :DOCUMENTATION NIL)
    (:TYPE :GENERIC :SYMBOL
     (:NAME "Q-EXISTED" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T) :LAMBDA-LIST
     ((:NAME "QUEUE" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL)
      (:NAME "ITEM" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :METHOD :SYMBOL
     (:NAME "Q-EXISTED" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T) :LAMBDA-LIST
     ((:NAME "Q" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL)
      (:NAME "ITEM" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :METHOD :SYMBOL
     (:NAME "Q-EXISTED" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T) :LAMBDA-LIST
     ((:NAME "Q" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL)
      (:NAME "ITEM" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :GENERIC :SYMBOL
     (:NAME "Q-POP" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T) :LAMBDA-LIST
     ((:NAME "QUEUE" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :METHOD :SYMBOL
     (:NAME "Q-POP" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T) :LAMBDA-LIST
     ((:NAME "QUEUE" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :METHOD :SYMBOL
     (:NAME "Q-POP" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T) :LAMBDA-LIST
     ((:NAME "QUEUE" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :GENERIC :SYMBOL
     (:NAME "Q-EMPTY" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T) :LAMBDA-LIST
     ((:NAME "QUEUE" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :METHOD :SYMBOL
     (:NAME "Q-EMPTY" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T) :LAMBDA-LIST
     ((:NAME "QUEUE" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :METHOD :SYMBOL
     (:NAME "Q-EMPTY" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T) :LAMBDA-LIST
     ((:NAME "QUEUE" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :GENERIC :SYMBOL
     (:NAME "Q-ADD" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T) :LAMBDA-LIST
     ((:NAME "QUEUE" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL)
      (:NAME "ITEM" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :METHOD :SYMBOL
     (:NAME "Q-ADD" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T) :LAMBDA-LIST
     ((:NAME "Q" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL)
      (:NAME "ITEM" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :METHOD :SYMBOL
     (:NAME "Q-ADD" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T) :LAMBDA-LIST
     ((:NAME "Q" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL)
      (:NAME "ITEM" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP NIL))
     :DOCUMENTATION NIL))
   :EXTERNAL-SYMBOLS
   ((:NAME "Q-EMPTY" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T)
    (:NAME "Q-EXISTED" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T)
    (:NAME "Q-ADD" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T)
    (:NAME "Q-POP" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T)
    (:NAME "MAKE-UNIQUE-QUEUE" :PACKAGE-NAME "UNIQUE-QUEUE" :EXTERNALP T)))
  (:TYPE :PACKAGE :NAME "WEB-CRAWLER" :FULL-NAME "WEB-CRAWLER" :DOCUMENTATION
   "Main package for web-crawler." :SYMBOL-LIST
   ((:TYPE :FUNCTION :SYMBOL
     (:NAME "SKIP-PAGE" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST ((:NAME "C" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :MACRO :SYMBOL
     (:NAME "CUT" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL) :LAMBDA-LIST
     ((:NAME "&BODY" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T)
      (:NAME "BODY" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "SPLIT-ON-ELEMENT" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST
     ((:NAME "SEQ" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
      (:NAME "EL" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION "Split any sequence into a list, using the given element
   as a separator.")
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "SPLIT-ON-NEWLINES" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST ((:NAME "TEXT" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "STRING-ONLY-WHITESPACE-P" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP
      NIL)
     :LAMBDA-LIST ((:NAME "TEXT" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "REMOVE-COMMENT" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST ((:NAME "LINE" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "PARSE-ROBOTS-TXT" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST ((:NAME "TEXT" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION "Parses the text of a robots.txt file and gives back
   a list of rules, each of the form
   (user-agent disallow-path*), where user-agent is a string,
   possibly \"*\".  An example rule is
   (\"*\" \"/cyberworld/map/\" \"/test/\" \"/test2\")")
    (:TYPE :VARIABLE :SYMBOL
     (:NAME "*SITE-ROBOTS-RULES*" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE "(MAKE-HASH-TABLE :TEST 'EQUAL)")
    (:TYPE :VARIABLE :SYMBOL
     (:NAME "*USER-AGENT*" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE "\"whatever, not used yet\"")
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "ROOT-OF-URI" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST ((:NAME "URI" :PACKAGE-NAME "PURI" :EXTERNALP T))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "GET-ROBOTS-URI" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST ((:NAME "URI" :PACKAGE-NAME "PURI" :EXTERNALP T))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "GET-ROBOTS-TXT" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST ((:NAME "URI" :PACKAGE-NAME "PURI" :EXTERNALP T))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "GET-ROBOTS-RULES" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST ((:NAME "URI" :PACKAGE-NAME "PURI" :EXTERNALP T))
     :DOCUMENTATION
     "Gets the robots.txt rules for a url as returned by parse-robots-txt.
Caches when possible.")
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "STARTS-WITH" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST
     ((:NAME "PRE" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
      (:NAME "SEQ" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "URI-IS-ALLOWED" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST ((:NAME "URI" :PACKAGE-NAME "PURI" :EXTERNALP T))
     :DOCUMENTATION "Check the robots.txt file for the site of this url, and
return whether the url is allowed for robots or not.")
    (:TYPE :VARIABLE :SYMBOL
     (:NAME "*USEFUL-LINK-ELEMENTS*" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP
      NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE
     "'((:A :HREF) (:AREA :HREF) (:BLOCKQUOTE :CITE) (:DEL :CITE) (:FRAME :SRC)
  (:IFRAME :SRC) (:INS :CITE) (:LAYER :SRC) (:LINK :HREF) (:Q :CITE)
  (:XMP :HREF))")
    (:TYPE :GENERIC :SYMBOL
     (:NAME "FIND-ALL-LINKS" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST
     ((:NAME "TEXT" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
      (:NAME "&OPTIONAL" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T)
      (:NAME "BASE" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :METHOD :SYMBOL
     (:NAME "FIND-ALL-LINKS" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST
     ((:NAME "HTML-TEXT" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
      (:NAME "&OPTIONAL" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T)
      (:NAME "BASE" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :METHOD :SYMBOL
     (:NAME "FIND-ALL-LINKS" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST
     ((:NAME "HTML-TEXT" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
      (:NAME "&OPTIONAL" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T)
      (:NAME "BASE" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "GET-ATTR" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL) :LAMBDA-LIST
     ((:NAME "ATTR" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
      (:NAME "ELEM" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "IS-SUCCESS" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST
     ((:NAME "STATUS-CODE" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :GENERIC :SYMBOL
     (:NAME "GET-PAGE" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL) :LAMBDA-LIST
     ((:NAME "URI" :PACKAGE-NAME "PURI" :EXTERNALP T)) :DOCUMENTATION
     "Do an HTTP GET request on a URI, closing the stream when the
request is done.  Returns
  (values <page content> <actual uri returned>)
The returned uri may be different due to a redirect.")
    (:TYPE :METHOD :SYMBOL
     (:NAME "GET-PAGE" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL) :LAMBDA-LIST
     (((:NAME "URI" :PACKAGE-NAME "PURI" :EXTERNALP T)
       (:NAME "URI" :PACKAGE-NAME "PURI" :EXTERNALP T)))
     :DOCUMENTATION NIL)
    (:TYPE :METHOD :SYMBOL
     (:NAME "GET-PAGE" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL) :LAMBDA-LIST
     (((:NAME "URI" :PACKAGE-NAME "PURI" :EXTERNALP T)
       (:NAME "URI" :PACKAGE-NAME "PURI" :EXTERNALP T)))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "MAKE-SAME-HOST-FILTER" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP T)
     :LAMBDA-LIST ((:NAME "URI" :PACKAGE-NAME "PURI" :EXTERNALP T))
     :DOCUMENTATION "Given a either a string uri or a puri:uri object,
returns a function that takes one uri as an argument and returns
true if that uri has the same hostname as the original uri.")
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "MAKE-SAVE-PAGE-PROCESSOR" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP
      NIL)
     :LAMBDA-LIST
     ((:NAME "&OPTIONAL" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T)
      ((:NAME "DIR" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
       (:NAME "*DEFAULT-PATHNAME-DEFAULTS*" :PACKAGE-NAME "COMMON-LISP"
        :EXTERNALP T)))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "CRAWL-AND-SAVE-SITE" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
     :LAMBDA-LIST
     ((:NAME "START-URI" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
      (:NAME "DIR" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
      (:NAME "&KEY" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T)
      ((:NAME "CRAWL-DELAY" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL) 10)
      (:NAME "VERBOSE" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION
     "Crawl a site (one hostname), starting at START-URI, and save every page
to a file in DIR.  The file index.dat will contain a list of filenames and
their uris, because uris don't work so well as filenames.")
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "START-CRAWL" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP T)
     :LAMBDA-LIST
     ((:NAME "URI" :PACKAGE-NAME "PURI" :EXTERNALP T)
      (:NAME "PROCESSOR" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
      (:NAME "&KEY" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T)
      (:NAME "URI-FILTER" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL)
      ((:NAME "CRAWL-DELAY" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL) 10)
      (:NAME "VERBOSE" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP NIL))
     :DOCUMENTATION "Crawl the web, starting at <uri>.

<processor> must be a function that takes three arguments, the current url,
the parent of the current url and the content returned from doing a GET request on that url.  
The return value is ignored.

<:uri-filter> can be a predicate that should return false if the passed
  url should not be processed.  The url will be an instance of the
  puri:url class, which should be easier to deal with than plain text.
  If you want plain text, call (puri:render-uri url nil), which will
  return it.
  To limit crawling to one site, call (make-same-host-filter uri) and pass
  the return value in for :uri-filter.

<:crawl-delay> is a number of seconds to sleep between requests.  The
  default is 10.  It can be a fraction.

<:verbose> when true, prints out each uri being processed."))
   :EXTERNAL-SYMBOLS
   ((:NAME "MAKE-SAME-HOST-FILTER" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP T)
    (:NAME "START-CRAWL" :PACKAGE-NAME "WEB-CRAWLER" :EXTERNALP T)))))
