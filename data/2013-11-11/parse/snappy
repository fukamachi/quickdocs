
(:TYPE :SYSTEM :NAME "snappy" :AUTHOR "Robert Brown" :MAINTAINER NIL :VERSION
 "0.2" :LICENCE
 "New BSD license.  See the copyright messages in individual files."
 :DESCRIPTION "An implementation of Snappy compression." :LONG-DESCRIPTION
 "An implementation of Google's Snappy compression algorithm, which is designed
for speed of compression and decompression."
 :DEPENDS-ON ("COM.GOOGLE.BASE" "NIBBLES" "VARINT") :PACKAGE-LIST
 ((:TYPE :PACKAGE :NAME "SNAPPY" :FULL-NAME "SNAPPY" :DOCUMENTATION
   "An implementation of Google's Snappy compression algorithm, which is
designed for speed of compression and decompression."
   :SYMBOL-LIST
   ((:TYPE :CONSTANT :SYMBOL
     (:NAME "+MAXIMUM-HASH-BITS+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE "#:G0")
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+MAXIMUM-HASH-BITS+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE "#:G0")
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+MAXIMUM-HASH-TABLE-SIZE+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE "#:G1")
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+MAXIMUM-HASH-TABLE-SIZE+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE "#:G1")
    (:TYPE :TYPE :SYMBOL
     (:NAME "HASH-RESULT" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL) :LAMBDA-LIST
     (:NAME "NIL" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T) :DOCUMENTATION NIL)
    (:TYPE :TYPE :SYMBOL
     (:NAME "TABLE-SIZE" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL) :LAMBDA-LIST
     (:NAME "NIL" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T) :DOCUMENTATION NIL)
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+LITERAL+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL) :DOCUMENTATION
     NIL :INITIAL-VALUE "#:G30")
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+LITERAL+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL) :DOCUMENTATION
     NIL :INITIAL-VALUE "#:G30")
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+COPY-1-BYTE-OFFSET+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE "#:G31")
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+COPY-1-BYTE-OFFSET+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE "#:G31")
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+COPY-2-BYTE-OFFSET+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE "#:G32")
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+COPY-2-BYTE-OFFSET+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE "#:G32")
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+COPY-4-BYTE-OFFSET+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE "#:G33")
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+COPY-4-BYTE-OFFSET+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE "#:G33")
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+VECTOR-INDEX-BITS+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE "#:G34")
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+VECTOR-INDEX-BITS+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :DOCUMENTATION NIL :INITIAL-VALUE "#:G34")
    (:TYPE :MACRO :SYMBOL
     (:NAME "POSTINCF" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL) :LAMBDA-LIST
     ((:NAME "VARIABLE" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "HASH" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL) :LAMBDA-LIST
     ((:NAME "BUFFER" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "INDEX" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "MASK" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "MAXIMUM-COMPRESSED-LENGTH" :PACKAGE-NAME "SNAPPY" :EXTERNALP T)
     :LAMBDA-LIST
     ((:NAME "UNCOMPRESSED-LENGTH" :PACKAGE-NAME "SNAPPY" :EXTERNALP T))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "UNCOMPRESSED-LENGTH" :PACKAGE-NAME "SNAPPY" :EXTERNALP T)
     :LAMBDA-LIST
     ((:NAME "BUFFER" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "INDEX" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "LIMIT" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "EMIT-LITERAL" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL) :LAMBDA-LIST
     ((:NAME "INPUT-BUFFER" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "LITERAL" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "OUTPUT-BUFFER" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "OUT" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "LENGTH" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "EMIT-COPY-LESS-THAN-64" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :LAMBDA-LIST
     ((:NAME "OUTPUT-BUFFER" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "OUT" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "OFFSET" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "LENGTH" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "EMIT-COPY" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL) :LAMBDA-LIST
     ((:NAME "OUTPUT-BUFFER" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "OUT" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "OFFSET" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "LENGTH" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "RAW-COMPRESS" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL) :LAMBDA-LIST
     ((:NAME "INPUT-BUFFER" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "IN" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "IN-LIMIT" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "OUTPUT-BUFFER" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "OUT" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "OUT-LIMIT" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "COMPRESS" :PACKAGE-NAME "SNAPPY" :EXTERNALP T) :LAMBDA-LIST
     ((:NAME "BUFFER" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "INDEX" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "LIMIT" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "RAW-UNCOMPRESS" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :LAMBDA-LIST
     ((:NAME "INPUT-BUFFER" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "IN" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "IN-LIMIT" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "OUTPUT-BUFFER" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "OUT" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "OUT-LIMIT" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :FUNCTION :SYMBOL
     (:NAME "UNCOMPRESS" :PACKAGE-NAME "SNAPPY" :EXTERNALP T) :LAMBDA-LIST
     ((:NAME "BUFFER" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "INDEX" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
      (:NAME "LIMIT" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL))
     :DOCUMENTATION NIL)
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+WORD-MASK+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL) :DOCUMENTATION
     "Mapping from i in range [0,4] to a mask to extract the bottom 8*i bits."
     :INITIAL-VALUE "#:G424")
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+WORD-MASK+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL) :DOCUMENTATION
     "Mapping from i in range [0,4] to a mask to extract the bottom 8*i bits."
     :INITIAL-VALUE "#:G424")
    (:TYPE :TYPE :SYMBOL
     (:NAME "DECOMPRESSION-ENTRY" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :LAMBDA-LIST (:NAME "NIL" :PACKAGE-NAME "COMMON-LISP" :EXTERNALP T)
     :DOCUMENTATION NIL)
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+DECOMPRESSION-TABLE+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :DOCUMENTATION "Data stored per entry in lookup table:
    Range   Bits-used       Description
    ------------------------------------
    1..64   0..7            Literal/copy length encoded in opcode byte
    0..7    8..10           Copy offset encoded in opcode byte / 256
    0..4    11..13          Extra bytes after opcode

We use eight bits for the length even though 7 would have sufficed
because of efficiency reasons:
    (1) Extracting a byte is faster than a bit-field
    (2) It properly aligns copy offset so we do not need a <<8"
     :INITIAL-VALUE "#:G427")
    (:TYPE :CONSTANT :SYMBOL
     (:NAME "+DECOMPRESSION-TABLE+" :PACKAGE-NAME "SNAPPY" :EXTERNALP NIL)
     :DOCUMENTATION "Data stored per entry in lookup table:
    Range   Bits-used       Description
    ------------------------------------
    1..64   0..7            Literal/copy length encoded in opcode byte
    0..7    8..10           Copy offset encoded in opcode byte / 256
    0..4    11..13          Extra bytes after opcode

We use eight bits for the length even though 7 would have sufficed
because of efficiency reasons:
    (1) Extracting a byte is faster than a bit-field
    (2) It properly aligns copy offset so we do not need a <<8"
     :INITIAL-VALUE "#:G427"))
   :EXTERNAL-SYMBOLS
   ((:NAME "UNCOMPRESS" :PACKAGE-NAME "SNAPPY" :EXTERNALP T)
    (:NAME "UNCOMPRESSED-LENGTH" :PACKAGE-NAME "SNAPPY" :EXTERNALP T)
    (:NAME "MAXIMUM-COMPRESSED-LENGTH" :PACKAGE-NAME "SNAPPY" :EXTERNALP T)
    (:NAME "COMPRESS" :PACKAGE-NAME "SNAPPY" :EXTERNALP T)))))
